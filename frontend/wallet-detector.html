<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet Detector</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        body {
            padding: 50px;
            max-width: 800px;
            margin: 0 auto;
        }

        .status-box {
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 2px solid;
        }

        .status-success {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10B981;
            color: #10B981;
        }

        .status-error {
            background: rgba(239, 68, 68, 0.1);
            border-color: #EF4444;
            color: #EF4444;
        }

        .status-warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: #F59E0B;
            color: #F59E0B;
        }

        pre {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>

<body>
    <h1>üîç Wallet Detection Tool</h1>
    <p>This tool will help us figure out what wallet you have installed.</p>

    <div id="detection-results"></div>

    <button class="btn btn-primary" onclick="tryConnect()" style="margin-top: 20px;">
        Try to Connect
    </button>

    <div id="connection-result" style="margin-top: 20px;"></div>

    <script>
        // Detection results
        const results = {
            ethereum: typeof window.ethereum !== 'undefined',
            ethereumDetails: window.ethereum ? {
                isMetaMask: window.ethereum.isMetaMask,
                isQIEWallet: window.ethereum.isQIEWallet,
                isCoinbaseWallet: window.ethereum.isCoinbaseWallet,
                isBraveWallet: window.ethereum.isBraveWallet,
                providers: window.ethereum.providers ? window.ethereum.providers.length : 0
            } : null,
            web3: typeof Web3 !== 'undefined'
        };

        // Display results
        function displayResults() {
            const container = document.getElementById('detection-results');
            let html = '';

            // Check if ethereum exists
            if (results.ethereum) {
                html += `<div class="status-box status-success">
                    <h3>‚úÖ Ethereum Provider Detected</h3>
                    <p>A wallet extension is installed!</p>
                </div>`;

                // Check which wallet
                const details = results.ethereumDetails;
                if (details.isQIEWallet) {
                    html += `<div class="status-box status-success">
                        <h3>üîÆ QIE Wallet Detected!</h3>
                        <p>Your QIE Wallet is installed and ready.</p>
                    </div>`;
                } else if (details.isMetaMask) {
                    html += `<div class="status-box status-warning">
                        <h3>ü¶ä MetaMask Detected</h3>
                        <p>MetaMask is installed. QIE Wallet might not be installed or is being overridden.</p>
                    </div>`;
                } else {
                    html += `<div class="status-box status-warning">
                        <h3>‚ö†Ô∏è Unknown Wallet</h3>
                        <p>A wallet is detected but we can't identify which one.</p>
                    </div>`;
                }

                // Show technical details
                html += `<div class="status-box" style="background: rgba(255,255,255,0.05); border-color: #666;">
                    <h3>Technical Details:</h3>
                    <pre>${JSON.stringify(details, null, 2)}</pre>
                </div>`;

            } else {
                html += `<div class="status-box status-error">
                    <h3>‚ùå No Wallet Detected</h3>
                    <p>No Ethereum wallet extension found. Please install QIE Wallet or MetaMask.</p>
                    <a href="https://www.qiewallet.me/" target="_blank" class="btn btn-primary" style="margin-top: 10px;">
                        Install QIE Wallet
                    </a>
                </div>`;
            }

            container.innerHTML = html;
        }

        // Try to connect
        async function tryConnect() {
            const resultDiv = document.getElementById('connection-result');
            resultDiv.innerHTML = '<p>Attempting to connect...</p>';

            if (typeof window.ethereum === 'undefined') {
                resultDiv.innerHTML = `<div class="status-box status-error">
                    <h3>‚ùå Cannot Connect</h3>
                    <p>No wallet extension detected. Please install QIE Wallet or MetaMask first.</p>
                </div>`;
                return;
            }

            try {
                console.log('Requesting accounts...');
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                console.log('Accounts received:', accounts);

                if (accounts && accounts.length > 0) {
                    resultDiv.innerHTML = `<div class="status-box status-success">
                        <h3>‚úÖ Connected Successfully!</h3>
                        <p><strong>Address:</strong> ${accounts[0]}</p>
                        <p>Your wallet is working correctly!</p>
                    </div>`;
                } else {
                    resultDiv.innerHTML = `<div class="status-box status-error">
                        <h3>‚ùå No Accounts</h3>
                        <p>Wallet responded but no accounts were returned.</p>
                    </div>`;
                }
            } catch (error) {
                console.error('Connection error:', error);
                resultDiv.innerHTML = `<div class="status-box status-error">
                    <h3>‚ùå Connection Failed</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p><strong>Code:</strong> ${error.code}</p>
                    <pre>${JSON.stringify(error, null, 2)}</pre>
                </div>`;
            }
        }

        // Run detection on load
        window.addEventListener('load', () => {
            displayResults();
        });
    </script>
</body>

</html>